import json
import os
from typing import Dict, Any

CONFIG_FILE = "config_data.json"

# 默认配置数据
DEFAULT_CONFIG = {
    f"难度{i+1}": config for i, config in enumerate([
        # 难度1
        {
            '比倍难度': 35,
            '吃分最大值': 2600,
            '吃分最小值': 600,
            '吃分返奖率': 55,
            '营业返奖率': 33,
            # 开奖奖项（每10000把出现的次数，总和应为10000）
            '三倍小奖': 5800,
            '苹果': 1280,
            '橘子': 500,
            '柠檬': 300,
            '金钟': 200,
            '西瓜': 500,
            '双星': 300,
            '99': 200,
            '小bar': 140,
            '中bar': 5,
            '大bar': 0,
            '金猪奖': 1275,
            # 加奖奖项（每10000把出现的次数，总和应为10000）
            '双响炮': 1000,
            '大四喜': 2500,
            '小三元': 2700,
            '大三元': 525,
            '彩金': 525,
            '开火车': 145,
            '统统有奖': 5,
            '大满贯': 0,
            '仙女散花': 1000,
            '小猫变身': 1600
        },
        # 难度2
        {
            '比倍难度': 55,
            '吃分最大值': 1200,
            '吃分最小值': 500,
            '吃分返奖率': 60,
            '营业返奖率': 50,
            '三倍小奖': 5130,
            '苹果': 1300,
            '橘子': 600,
            '柠檬': 360,
            '金钟': 240,
            '西瓜': 600,
            '双星': 360,
            '99': 240,
            '小bar': 150,
            '中bar': 15,
            '大bar': 5,
            '金猪奖': 1400,
            '双响炮': 940,
            '大四喜': 2500,
            '小三元': 2800,
            '大三元': 525,
            '彩金': 525,
            '开火车': 150,
            '统统有奖': 15,
            '大满贯': 2,
            '仙女散花': 940,
            '小猫变身': 1603
        },
        # 难度3
        {
            '比倍难度': 45,
            '吃分最大值': 2800,
            '吃分最小值': 800,
            '吃分返奖率': 58,
            '营业返奖率': 45,
            '三倍小奖': 5420,
            '苹果': 1300,
            '橘子': 600,
            '柠檬': 360,
            '金钟': 240,
            '西瓜': 600,
            '双星': 360,
            '99': 240,
            '小bar': 150,
            '中bar': 15,
            '大bar': 3,
            '金猪奖': 1162,
            '双响炮': 1000,
            '大四喜': 2500,
            '小三元': 2800,
            '大三元': 525,
            '彩金': 525,
            '开火车': 135,
            '统统有奖': 15,
            '大满贯': 0,
            '仙女散花': 1000,
            '小猫变身': 1500
        },
        # 难度4
        {
            '比倍难度': 43,
            '吃分最大值': 2600,
            '吃分最小值': 800,
            '吃分返奖率': 68,
            '营业返奖率': 40,
            '三倍小奖': 5740,
            '苹果': 1320,
            '橘子': 600,
            '柠檬': 360,
            '金钟': 240,
            '西瓜': 600,
            '双星': 360,
            '99': 240,
            '小bar': 150,
            '中bar': 15,
            '大bar': 2,
            '金猪奖': 1183,
            '双响炮': 1225,
            '大四喜': 2500,
            '小三元': 2800,
            '大三元': 525,
            '彩金': 525,
            '开火车': 150,
            '统统有奖': 15,
            '大满贯': 0,
            '仙女散花': 1225,
            '小猫变身': 1035
        },
        # 难度5
        {
            '比倍难度': 36,
            '吃分最大值': 3600,
            '吃分最小值': 1200,
            '吃分返奖率': 60,
            '营业返奖率': 36,
            '三倍小奖': 5600,
            '苹果': 1270,
            '橘子': 600,
            '柠檬': 360,
            '金钟': 240,
            '西瓜': 600,
            '双星': 360,
            '99': 240,
            '小bar': 150,
            '中bar': 15,
            '大bar': 1,
            '金猪奖': 1164,
            '双响炮': 1000,
            '大四喜': 2500,
            '小三元': 2800,
            '大三元': 525,
            '彩金': 525,
            '开火车': 145,
            '统统有奖': 5,
            '大满贯': 0,
            '仙女散花': 1000,
            '小猫变身': 1500
        },
        # 难度6
        {
            '比倍难度': 33,
            '吃分最大值': 3600,
            '吃分最小值': 1800,
            '吃分返奖率': 66,
            '营业返奖率': 33,
            '三倍小奖': 5740,
            '苹果': 1300,
            '橘子': 550,
            '柠檬': 330,
            '金钟': 220,
            '西瓜': 550,
            '双星': 330,
            '99': 220,
            '小bar': 148,
            '中bar': 12,
            '大bar': 0,
            '金猪奖': 1150,
            '双响炮': 2000,
            '大四喜': 1500,
            '小三元': 2400,
            '大三元': 525,
            '彩金': 525,
            '开火车': 60,
            '统统有奖': 5,
            '大满贯': 0,
            '仙女散花': 2000,
            '小猫变身': 923
        },
        # 难度7
        {
            '比倍难度': 32,
            '吃分最大值': 3600,
            '吃分最小值': 1600,
            '吃分返奖率': 35,
            '营业返奖率': 33,
            '三倍小奖': 5970,
            '苹果': 1260,
            '橘子': 540,
            '柠檬': 324,
            '金钟': 216,
            '西瓜': 540,
            '双星': 324,
            '99': 216,
            '小bar': 130,
            '中bar': 15,
            '大bar': 0,
            '金猪奖': 1190,
            '双响炮': 2500,
            '大四喜': 2500,
            '小三元': 800,
            '大三元': 525,
            '彩金': 525,
            '开火车': 130,
            '统统有奖': 15,
            '大满贯': 0,
            '仙女散花': 2500,
            '小猫变身': 505
        },
        # 难度8
        {
            '比倍难度': 34,
            '吃分最大值': 5000,
            '吃分最小值': 2000,
            '吃分返奖率': 68,
            '营业返奖率': 20,
            '三倍小奖': 5860,
            '苹果': 1100,
            '橘子': 500,
            '柠檬': 300,
            '金钟': 200,
            '西瓜': 500,
            '双星': 300,
            '99': 200,
            '小bar': 110,
            '中bar': 15,
            '大bar': 5,
            '金猪奖': 900,
            '双响炮': 1500,
            '大四喜': 2500,
            '小三元': 2800,
            '大三元': 525,
            '彩金': 525,
            '开火车': 130,
            '统统有奖': 15,
            '大满贯': 5,
            '仙女散花': 1500,
            '小猫变身': 500
        },
        # 难度9
        {
            '比倍难度': 33,
            '吃分最大值': 3800,
            '吃分最小值': 800,
            '吃分返奖率': 69,
            '营业返奖率': 35,
            '三倍小奖': 5720,
            '苹果': 1330,
            '橘子': 500,
            '柠檬': 300,
            '金钟': 200,
            '西瓜': 500,
            '双星': 300,
            '99': 200,
            '小bar': 150,
            '中bar': 15,
            '大bar': 2,
            '金猪奖': 1183,
            '双响炮': 1000,
            '大四喜': 2500,
            '小三元': 2800,
            '大三元': 525,
            '彩金': 525,
            '开火车': 133,
            '统统有奖': 15,
            '大满贯': 2,
            '仙女散花': 1000,
            '小猫变身': 1500
        }
    ])
}

def load_config() -> Dict[str, Any]:
    """
    从文件加载配置数据
    如果文件不存在，则返回默认配置
    """
    if os.path.exists(CONFIG_FILE):
        try:
            with open(CONFIG_FILE, 'r', encoding='utf-8') as f:
                config = json.load(f)
            # 验证配置格式是否正确
            if isinstance(config, dict) and all(f"难度{i}" in config for i in range(1, 10)):
                print("使用用户自定义配置")
                return config
            else:
                print("用户配置文件格式不正确，使用默认配置")
        except Exception as e:
            print(f"加载用户配置文件时出错: {e}，使用默认配置")
    
    # 如果没有用户配置文件或加载失败，初始化默认配置文件
    print("使用默认配置并创建配置文件")
    save_config(DEFAULT_CONFIG)
    return DEFAULT_CONFIG

def save_config(config_data: Dict[str, Any]) -> bool:
    """
    将配置数据保存到文件
    """
    try:
        with open(CONFIG_FILE, 'w', encoding='utf-8') as f:
            json.dump(config_data, f, ensure_ascii=False, indent=2)
        return True
    except Exception as e:
        print(f"保存配置文件时出错: {e}")
        return False