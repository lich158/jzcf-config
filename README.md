# 水果机配置管理系统

## 项目简介

水果机配置管理系统用于集中管理和动态推送游戏难度、奖项、返奖率等核心参数，提升运营灵活性和玩家体验。

## 核心功能

- 提供Web界面进行可视化配置管理
- 支持9种难度级别的精细化配置
- 实时通过WebSocket向客户端广播配置更新
- 配置数据持久化存储，重启后不丢失

## 快速开始

### 一键部署服务

```bash
sudo ./deploy_service.sh
```

访问地址: http://localhost:9092

## 系统架构

```
┌─────────────┐        ┌─────────────┐
│  浏览器     │←HTTP→│  Web服务器  │
│  (前端)     │        │  (FastAPI)  │
└─────────────┘        └─────────────┘
                                 ↓ WebSocket
                          ┌─────────────┐
                          │ 客户端设备  │
                          │ (客户端)    │
                          └─────────────┘
```

## 配置文件说明

系统使用以下配置文件：

- `config_data.json` - 用户自定义配置文件（系统自动生成）
- `config_manager.py` - 配置加载和保存功能

系统启动时会优先加载 `config_data.json` 中的配置，如果文件不存在则使用默认配置并创建该文件。

## API 接口

### 轻量级服务 (`lightweight_backend.py`)

- GET `/` - Web管理界面
- GET `/ws/lightweight` - 轻量级WebSocket连接端点
- POST `/send` - 更新配置并广播给客户端

## 登录认证

所有接口都需要HTTP Basic认证:

- 用户名: `lich`
- 密码: `123123`

## 配置持久化

所有通过Web界面修改的配置都会自动保存到 `config_data.json` 文件中，确保服务重启后配置不会丢失。

## 简化说明

为了保持系统简洁，我们做了以下改进：

1. 删除了所有多余的模拟器和测试设备文件
2. 移除了 `difficulty_config.py` 文件，将默认配置直接放在 `config_manager.py` 中
3. 系统直接使用 `config_data.json` 中的数据，无需额外的配置处理层
4. 合并了安装和部署脚本，提供统一的 `deploy_service.sh` 一键部署脚本
5. 修复了服务启动脚本和服务文件，确保可以正常开机自启
6. 修正了端口配置，轻量级服务使用9092端口

现在的系统更加简洁高效，专注于核心功能：Web配置管理和实时下发。